services:
  mosquitto:
    image: eclipse-mosquitto
    container_name: mosquitto
    volumes:
      - ${DATA_PREFIX}/mqtt/config:/mosquitto/config
      - ${DATA_PREFIX}/mqtt/data:/mosquitto/data
      - ${DATA_PREFIX}/mqtt/log:/mosquitto/log
    ports:
      - 1883:1883
    #  - 8883:8883
      - 9001:9001
    stdin_open: true
    tty: true
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.tcp.routers.mqtt.rule=HostSNI(`mqtt.${NETWORK_DOMAIN}`)"
      - "traefik.tcp.routers.mqtt.entrypoints=mqttsecure"
      - "traefik.tcp.routers.mqtt.tls=true"
      - "traefik.tcp.routers.mqtt.service=mqtt"
      - "traefik.tcp.services.mqtt.loadbalancer.server.port=1883"
      - "traefik.tcp.routers.mqtt.rule=HostSNI(`mqtt.${NETWORK_DOMAIN}`)"
      - "traefik.tcp.routers.mqtt.entrypoints=websocket"
      - "traefik.tcp.routers.mqtt.tls=true"
      - "traefik.tcp.routers.mqtt.service=mqtt-websocket"
      - "traefik.tcp.services.mqtt-websocket.loadbalancer.server.port=9001"